box: golang:1.9
no-response-timeout: 60
command-timeout: 60

test:
  base-path: "/go/src/github.com/oracle/mysql-operator"
  steps:
    - script:
      name: test
      code: make test

build:
  base-path: "/go/src/github.com/oracle/mysql-operator"
  steps:
    - script:
      name: build binaries
      code: make build

    - script:
      name: copy build artifacts
      code: |
        cp -R bin ${WERCKER_OUTPUT_DIR}/
        cp -R dist ${WERCKER_OUTPUT_DIR}/

    - script:
      name: copy test artifacts
      code: |
        cp -R Makefile ${WERCKER_OUTPUT_DIR}/
        cp -R cmd ${WERCKER_OUTPUT_DIR}/
        cp -R pkg ${WERCKER_OUTPUT_DIR}/
        cp -R test ${WERCKER_OUTPUT_DIR}/
        cp -R vendor ${WERCKER_OUTPUT_DIR}/
        cp -R hack ${WERCKER_OUTPUT_DIR}/
        cp -R mysql-operator ${WERCKER_OUTPUT_DIR}/
        cp -R .git ${WERCKER_OUTPUT_DIR}/
        cp -R docker ${WERCKER_OUTPUT_DIR}/

push-operator-image:
  steps:
    - script:
      name: test
      code: |
        ls -lah
        ls -lah ${WERCKER_ROOT}

    - internal/docker-build:
      dockerfile: docker/mysql-agent/Dockerfile
      image-name: wercker-build-mysql-agent
      build-args: "MYSQL_USER=27"
